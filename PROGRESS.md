# PROGRESS — BanKisha (要旨)

最終更新: 2025-12-27

## 🎯 目的
- インタビューの「質問生成」機能の復旧（完了）。
- インタビュー冒頭のスクリプト調整、ブランディングの動体化、およびリハーサルモードの不具合改修。

---

## ✅ 実施済み（成果）

### ブランディングとUI改善 (2025-12-27)
- **インタビュー冒頭スクリプトの刷新**:
  - ユーザー指定の構成（[アカウント名]の[インタビュアー名]...[媒体]に掲載予定）に沿ったプロンプトおよびフォールバックロジックを実装。
  - 質問生成画面で冒頭メッセージを確認・編集できる機能を追加。
- **動的ブランディング（会社名連携）**:
  - 記事プレビュー、詳細画面、公開記事のメタデータ（JSON-LD/OGP）において、ハードコードされていた「BanKisha編集部」を Firestore から取得した正しい会社名に動的に置換。
- **リハーサルモードのリセット機能修正**:
  - 「リセット」ボタン押下時に、冒頭のマイクテストからやり直せるようロジックを修正。
  - リハーサル停止時にメディアリソース（マイク）を確実に解放する処理を追加。

### インフラ・バックエンド (2025-12-26以前)
- **Firebase Admin SDK 認証修正**:
  - サービスアカウントキーの破損を検知し、自動修復（PEMヘッダ/フッタ整形、改行コード、Base64パディング補完）するロジックを `firebase-admin.ts` に実装。
- **Gemini API JSON 抽出の安定化**:
  - プロンプトの厳格化と、正規表現による寛容な JSON パース処理の導入により、質問生成の成功率を大幅に向上。
- **Cloud Run デプロイ**:
  - 依存関係の修正と型エラーの解消により、安定したデプロイ環境を構築。

---

## ⚠️ 現在の状況（開発中の機能 / 課題）
- **記事作成時の会社概要情報の収集**:
  - インタビュー中に取材先がテキストで「サービス名、会社名、住所、URL」を入力できる仕組みを検討中。
  - 記事作成画面における自由なフォーム項目（追加・削除）の追記機能の検討中。

---

## 🔧 次の優先タスク（推奨順）
1. **取材先によるテキスト入力機能の実装**: インタビュー画面に補足情報（会社概要等）の入力フォームを追加し、音声認識のミスを防ぐ。
2. **記事エディタの柔軟性向上**: フォーム項目の動的な追加・削除機能の実装。
3. **Firestore スキーマ拡張**: 収集したテキスト情報を `InterviewSession` または `Article` に適切に永続化する。

---

## 🧾 重要なログ抜粋
- 2025-12-27: Branding applied successfully to `ArticleDetail.tsx` and `ArticleView.tsx`.
- 2025-12-27: Rehearsal reset logic verified with `micTestPassed(false)`.